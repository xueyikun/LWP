{"remainingRequest":"C:\\Users\\w9747\\Downloads\\vue_cloud_music-master\\vue_cloud_music-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\w9747\\Downloads\\vue_cloud_music-master\\vue_cloud_music-master\\src\\views\\search\\searchChildren\\SearchSong.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\w9747\\Downloads\\vue_cloud_music-master\\vue_cloud_music-master\\src\\views\\search\\searchChildren\\SearchSong.vue","mtime":1636482832195},{"path":"C:\\Users\\w9747\\Downloads\\vue_cloud_music-master\\vue_cloud_music-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1636408355875},{"path":"C:\\Users\\w9747\\Downloads\\vue_cloud_music-master\\vue_cloud_music-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1636408357214},{"path":"C:\\Users\\w9747\\Downloads\\vue_cloud_music-master\\vue_cloud_music-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1636408355875},{"path":"C:\\Users\\w9747\\Downloads\\vue_cloud_music-master\\vue_cloud_music-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1636408357599}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGhhbmRsZU11c2ljVGltZSB9IGZyb20gInBsdWdpbnMvdXRpbHMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlNlYXJjaFNvbmciLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBtdWx0aU1hdGNoOiB7fSwKICAgICAgc2VhcmNoU29uZ0xpc3Q6IFtdLAogICAgICBzb25nQ291bnQ6IDAsCiAgICAgIGN1cnJlbnRQYWdlOiAxLAogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOivt+axggogICAgLy8g6I635Y+W5pyA5L2z5Yy56YWNCiAgICBhc3luYyBnZXRNdWx0TWF0aCgpIHsKICAgICAgbGV0IHJlcyA9IGF3YWl0IHRoaXMuJHJlcXVlc3QoIi9zZWFyY2gvbXVsdGltYXRjaCIsIHsKICAgICAgICBrZXl3b3JkczogdGhpcy4kcm91dGUucGFyYW1zLmlkLAogICAgICB9KTsKICAgICAgdGhpcy5tdWx0aU1hdGNoID0gcmVzLmRhdGEucmVzdWx0OwogICAgfSwKCiAgICAvLyDor7fmsYLmkJzntKLljZXmm7IKICAgIGFzeW5jIGdldFNlYXJjaFNvbmcoKSB7CiAgICAgIGxldCByZXMgPSBhd2FpdCB0aGlzLiRyZXF1ZXN0KCIvY2xvdWRzZWFyY2giLCB7CiAgICAgICAga2V5d29yZHM6IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCwKICAgICAgICBvZmZzZXQ6IDMwICogKHRoaXMuY3VycmVudFBhZ2UgLSAxKSwKICAgICAgfSk7CiAgICAgIGNvbnNvbGUubG9nKHJlcyk7CiAgICAgIHRoaXMuc29uZ0NvdW50ID0gcmVzLmRhdGEucmVzdWx0LnNvbmdDb3VudDsKICAgICAgdGhpcy5zZWFyY2hTb25nTGlzdCA9IHJlcy5kYXRhLnJlc3VsdC5zb25nczsKICAgICAgLy8g5a+55pWw5o2u55qE6Z+z5LmQ5pe26ZW/6L+b6KGM5aSE55CGCiAgICAgIHRoaXMuc2VhcmNoU29uZ0xpc3QuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgICAgICB0aGlzLnNlYXJjaFNvbmdMaXN0W2luZGV4XS5kdCA9IGhhbmRsZU11c2ljVGltZShpdGVtLmR0KTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8vIOS6i+S7tuWTjeW6lAogICAgLy8g5aSE55CG57Si5byVCiAgICBoYW5kbGVJbmRleChpbmRleCkgewogICAgICAvLyBjb25zb2xlLmxvZyhpbmRleCk7CiAgICAgIGluZGV4ID0gaW5kZXggKyAxICsgMzAgKiAodGhpcy5jdXJyZW50UGFnZSAtIDEpOwogICAgICBpZiAoaW5kZXggPCAxMCkgewogICAgICAgIHJldHVybiAiMCIgKyBpbmRleDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgIH0sCiAgICAvLyDlj4zlh7t0YWJsZeeahHJvd+eahOWbnuiwgwogICAgYXN5bmMgY2xpY2tSb3cocm93KSB7CiAgICAgIC8vIOi/memHjOWPjOWHu+W6lOivpeaYr+imgeaKiuW9k+WJjeWPjOWHu+eahOatjOabsuaPkuWFpeWIsOW9k+WJjeeahOatjOWNleS4rQogICAgICAvLyDpppblhYjojrflj5blvZPliY3nmoTmrYzljZXliJfooajlkozmrYzmm7LntKLlvJUKICAgICAgbGV0IG11c2ljTGlzdCA9IHRoaXMuJHN0b3JlLnN0YXRlLm11c2ljTGlzdDsKICAgICAgbGV0IGN1cnJlbnRJbmRleCA9IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRJbmRleDsKICAgICAgLy8g5YWI5Yik5pat6K+l5q2M5puy5piv5ZCm5bey57uP5Zyo5q2M5Y2V5Lit5a2Y5Zyo77yM6YG/5YWN6YeN5aSN54K55Ye75a+86Ie05q2M5Y2V5Ye6546w55u45ZCM5q2M5puyCiAgICAgIGxldCBpc0V4aXN0ID0gbXVzaWNMaXN0LmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT0gcm93LmlkKTsKICAgICAgaWYgKGlzRXhpc3QpIHsKICAgICAgICAvLyDlpoLmnpzlt7Lnu4/lrZjlnKgg5YiZ5Y+q5o+Q5Lqk5q2M5puyaWTlubZyZXR1cm7lh7rljrsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZU11c2ljSWQiLCByb3cuaWQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLiRzdG9yZS5jb21taXQoImNoYW5nZVBsYXlTdGF0ZSIsIGZhbHNlKTsKICAgICAgLy8g5bCG6K+35rGC5Yiw55qE5q2M5puy6K+m5oOF5o+S5YWl5Yiw5q2M5Y2V5a+55bqU5L2N572u5bm25o+Q5Lqk6IezdnVleAogICAgICBtdXNpY0xpc3Quc3BsaWNlKGN1cnJlbnRJbmRleCArIDEsIDAsIHJvdyk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgidXBkYXRlTXVzaWNJZCIsIHJvdy5pZCk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgidXBkYXRlTXVzaWNMaXN0IiwgewogICAgICAgIG11c2ljTGlzdCwKICAgICAgICBtdXNpY0xpc3RJZDogdGhpcy4kc3RvcmUuc3RhdGUubXVzaWNMaXN0SWQsCiAgICAgIH0pOwogICAgfSwKICAgIC8vIOivhOiuuueCueWHu+e/u+mhteeahOWbnuiwgwogICAgcGFnZUNoYW5nZShwYWdlKSB7CiAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSBwYWdlOwogICAgICB0aGlzLnNlYXJjaFNvbmdMaXN0ID0gW107CiAgICAgIHRoaXMuZ2V0U2VhcmNoU29uZygpOwogICAgfSwKICAgIC8vIOeCueWHu+acgOS9s+WMuemFjeeahOWbnuiwgwogICAgZ29Ub1NpbmdlckRldGFpbChpZCkgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICJzaW5nZXJEZXRhaWwiLCBwYXJhbXM6IHsgaWQgfSB9KTsKICAgIH0sCgogICAgLy8g54K55Ye75Y2V5YWD5qC855qE5Zue6LCDCiAgICBhc3luYyBjbGlja0NlbGwocm93LCBjb2x1bW4sIGNlbGwpIHsKICAgICAgLy8g5Yik5pat54K55Ye755qE5piv5LiL6L295oyJ6ZKuCiAgICAgIGlmIChjZWxsLnF1ZXJ5U2VsZWN0b3IoIi5pY29uLWRvd25sb2FkIikpIHsKICAgICAgICAvLyDor7fmsYLor6XmrYzmm7LnmoR1cmwKICAgICAgICBjb25zb2xlLmxvZyhyb3cpOwogICAgICAgIGxldCByZXMgPSBhd2FpdCB0aGlzLiRyZXF1ZXN0KCIvc29uZy91cmwiLCB7IGlkOiByb3cuaWQgfSk7CiAgICAgICAgY29uc29sZS5sb2cocmVzKTsKICAgICAgICBpZiAocmVzLmRhdGEuZGF0YVswXS51cmwgPT0gbnVsbCkgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCLmmoLml7bml6Dms5Xojrflj5bor6XotYTmupDlk6YhIik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDljLnphY3otYTmupDnmoTln5/lkI0KICAgICAgICBsZXQgdXJsID0gcmVzLmRhdGEuZGF0YVswXS51cmwubWF0Y2goL1xodHRwLio/XC5uZXQvKTsKICAgICAgICAvLyDljLnphY3ln5/lkI3lkI3np7DvvIzlubbljLnphY3lr7nlupTnmoTku6PnkIYKICAgICAgICBsZXQgc2VydmUgPSB1cmxbMF0ubWF0Y2goL2h0dHA6XC8oXFMqKS5tdXNpYy8pWzFdOwogICAgICAgIGlmICgKICAgICAgICAgIHNlcnZlICE9ICIvbTciICYmCiAgICAgICAgICBzZXJ2ZSAhPSAiL203MDEiICYmCiAgICAgICAgICBzZXJ2ZSAhPSAiL204IiAmJgogICAgICAgICAgc2VydmUgIT0gIi9tODAxIgogICAgICAgICkgewogICAgICAgICAgLy8g5rKh5pyJ5a+55bqU55qE5Luj55CGCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLljLnphY3kuI3liLDlr7nlupTnmoTku6PnkIYs5LiL6L295aSx6LSlISIpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyDmiKrlj5blkI7pnaLnmoTlj4LmlbAKICAgICAgICBsZXQgcGFyYW1zID0gcmVzLmRhdGEuZGF0YVswXS51cmwuc2xpY2UodXJsWzBdLmxlbmd0aCk7CiAgICAgICAgLy8gY29uc29sZS5sb2codXJsWzBdLCBzZXJ2ZSwgcGFyYW1zKTsKCiAgICAgICAgbGV0IGRvd25sb2FkTXVzaWNJbmZvID0gewogICAgICAgICAgdXJsOiBzZXJ2ZSArIHBhcmFtcywKICAgICAgICAgIG5hbWU6CiAgICAgICAgICAgIHJvdy5uYW1lICsKICAgICAgICAgICAgIiAtICIgKwogICAgICAgICAgICByb3cuYXJbMF0ubmFtZSArCiAgICAgICAgICAgICIuIiArCiAgICAgICAgICAgIHJlcy5kYXRhLmRhdGFbMF0udHlwZS50b0xvd2VyQ2FzZSgpLAogICAgICAgIH07CiAgICAgICAgY29uc29sZS5sb2coZG93bmxvYWRNdXNpY0luZm8pOwogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgidXBkYXRlRG93bmxvYWRNdXNpY0luZm8iLCBkb3dubG9hZE11c2ljSW5mbyk7CiAgICAgIH0KICAgIH0sCiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRNdWx0TWF0aCgpOwogICAgdGhpcy5nZXRTZWFyY2hTb25nKCk7CiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpOwogIH0sCiAgd2F0Y2g6IHt9LAp9Owo="},{"version":3,"sources":["SearchSong.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SearchSong.vue","sourceRoot":"src/views/search/searchChildren","sourcesContent":["<template>\n  <div class=\"SearchSong\">\n    <div class=\"tip\">找到 {{ songCount }} 首单曲</div>\n    <div class=\"multiMatch\" v-if=\"multiMatch.artist && currentPage == 1\">\n      <div class=\"matchTitle\">最佳匹配</div>\n      <div\n        class=\"matchResult\"\n        @click=\"goToSingerDetail(multiMatch.artist[0].id)\"\n      >\n        <div class=\"matchCover\">\n          <img\n            :src=\"multiMatch.artist[0].img1v1Url + '?param==200y200'\"\n            alt=\"\"\n          />\n        </div>\n        <div class=\"matchName\">歌手：{{ multiMatch.artist[0].name }}</div>\n        <i class=\"iconfont icon-arrow-right-bold\"></i>\n      </div>\n    </div>\n    <!-- 这里的播放效果样式不能直接简单的操作DOM，因为有分页，也可以做成无限滚动，或者根据索引渲染，但是我懒得搞了 -->\n    <el-table\n      :data=\"searchSongList\"\n      size=\"mini\"\n      style=\"width: 100%\"\n      @row-dblclick=\"clickRow\"\n      @cell-click=\"clickCell\"\n      highlight-current-row\n      stripe\n    >\n      <el-table-column label=\"\" width=\"30\" type=\"index\" :index=\"handleIndex\">\n      </el-table-column>\n      <el-table-column label=\"\" width=\"23\">\n        <i class=\"iconfont icon-download\"></i>\n      </el-table-column>\n      <el-table-column prop=\"name\" label=\"音乐标题\" min-width=\"200\">\n      </el-table-column>\n      <el-table-column prop=\"ar[0].name\" label=\"歌手\" min-width=\"100\">\n      </el-table-column>\n      <el-table-column prop=\"al.name\" label=\"专辑\" min-width=\"170\">\n      </el-table-column>\n      <el-table-column prop=\"dt\" label=\"时长\" min-width=\"60\"> </el-table-column>\n    </el-table>\n    <!-- 分页 -->\n    <div class=\"page\" v-if=\"searchSongList.length != 0\">\n      <el-pagination\n        background\n        layout=\"prev, pager, next\"\n        :total=\"songCount\"\n        small\n        :page-size=\"30\"\n        :current-page=\"currentPage\"\n        @current-change=\"pageChange\"\n      >\n      </el-pagination>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { handleMusicTime } from \"plugins/utils\";\nexport default {\n  name: \"SearchSong\",\n  data() {\n    return {\n      multiMatch: {},\n      searchSongList: [],\n      songCount: 0,\n      currentPage: 1,\n    };\n  },\n  methods: {\n    // 请求\n    // 获取最佳匹配\n    async getMultMath() {\n      let res = await this.$request(\"/search/multimatch\", {\n        keywords: this.$route.params.id,\n      });\n      this.multiMatch = res.data.result;\n    },\n\n    // 请求搜索单曲\n    async getSearchSong() {\n      let res = await this.$request(\"/cloudsearch\", {\n        keywords: this.$route.params.id,\n        offset: 30 * (this.currentPage - 1),\n      });\n      console.log(res);\n      this.songCount = res.data.result.songCount;\n      this.searchSongList = res.data.result.songs;\n      // 对数据的音乐时长进行处理\n      this.searchSongList.forEach((item, index) => {\n        this.searchSongList[index].dt = handleMusicTime(item.dt);\n      });\n    },\n\n    // 事件响应\n    // 处理索引\n    handleIndex(index) {\n      // console.log(index);\n      index = index + 1 + 30 * (this.currentPage - 1);\n      if (index < 10) {\n        return \"0\" + index;\n      } else {\n        return index;\n      }\n    },\n    // 双击table的row的回调\n    async clickRow(row) {\n      // 这里双击应该是要把当前双击的歌曲插入到当前的歌单中\n      // 首先获取当前的歌单列表和歌曲索引\n      let musicList = this.$store.state.musicList;\n      let currentIndex = this.$store.state.currentIndex;\n      // 先判断该歌曲是否已经在歌单中存在，避免重复点击导致歌单出现相同歌曲\n      let isExist = musicList.find((item) => item.id == row.id);\n      if (isExist) {\n        // 如果已经存在 则只提交歌曲id并return出去\n        this.$store.commit(\"updateMusicId\", row.id);\n        return;\n      }\n      this.$store.commit(\"changePlayState\", false);\n      // 将请求到的歌曲详情插入到歌单对应位置并提交至vuex\n      musicList.splice(currentIndex + 1, 0, row);\n      this.$store.commit(\"updateMusicId\", row.id);\n      this.$store.commit(\"updateMusicList\", {\n        musicList,\n        musicListId: this.$store.state.musicListId,\n      });\n    },\n    // 评论点击翻页的回调\n    pageChange(page) {\n      this.currentPage = page;\n      this.searchSongList = [];\n      this.getSearchSong();\n    },\n    // 点击最佳匹配的回调\n    goToSingerDetail(id) {\n      this.$router.push({ name: \"singerDetail\", params: { id } });\n    },\n\n    // 点击单元格的回调\n    async clickCell(row, column, cell) {\n      // 判断点击的是下载按钮\n      if (cell.querySelector(\".icon-download\")) {\n        // 请求该歌曲的url\n        console.log(row);\n        let res = await this.$request(\"/song/url\", { id: row.id });\n        console.log(res);\n        if (res.data.data[0].url == null) {\n          this.$message.warning(\"暂时无法获取该资源哦!\");\n          return;\n        }\n\n        // 匹配资源的域名\n        let url = res.data.data[0].url.match(/\\http.*?\\.net/);\n        // 匹配域名名称，并匹配对应的代理\n        let serve = url[0].match(/http:\\/(\\S*).music/)[1];\n        if (\n          serve != \"/m7\" &&\n          serve != \"/m701\" &&\n          serve != \"/m8\" &&\n          serve != \"/m801\"\n        ) {\n          // 没有对应的代理\n          this.$message.error(\"匹配不到对应的代理,下载失败!\");\n          return;\n        }\n        // 截取后面的参数\n        let params = res.data.data[0].url.slice(url[0].length);\n        // console.log(url[0], serve, params);\n\n        let downloadMusicInfo = {\n          url: serve + params,\n          name:\n            row.name +\n            \" - \" +\n            row.ar[0].name +\n            \".\" +\n            res.data.data[0].type.toLowerCase(),\n        };\n        console.log(downloadMusicInfo);\n        this.$store.commit(\"updateDownloadMusicInfo\", downloadMusicInfo);\n      }\n    },\n  },\n  created() {\n    this.getMultMath();\n    this.getSearchSong();\n    // console.log(this.$route.params.id);\n  },\n  watch: {},\n};\n</script>\n\n<style scoped>\n.SearchSong {\n  padding: 0 15px;\n}\n\n.tip {\n  font-weight: bold;\n  color: rgb(34, 34, 34);\n  margin-bottom: 10px;\n}\n\n.matchTitle {\n  font-size: 12px;\n  color: rgb(34, 34, 34);\n  margin: 5px 0;\n}\n\n.matchResult {\n  display: flex;\n  align-items: center;\n  position: relative;\n  border-radius: 5px;\n  overflow: hidden;\n  background-color: #f4f4f4;\n  width: 270px;\n  height: 65px;\n  margin-bottom: 20px;\n  cursor: pointer;\n}\n\n.matchCover {\n  width: 65px;\n  height: 65px;\n}\n\n.matchCover img {\n  width: 100%;\n  height: 100%;\n}\n\n.matchName {\n  font-size: 13px;\n  color: rgb(31, 31, 31);\n  margin-left: 10px;\n}\n\n.multiMatch i {\n  position: absolute;\n  transform: translateY(-50%);\n  right: 15px;\n  top: 50%;\n}\n\n.page {\n  width: 100%;\n  text-align: center;\n  padding-bottom: 20px;\n  margin: 20px 0;\n}\n</style>"]}]}