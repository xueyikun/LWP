{"remainingRequest":"D:\\vue_cloud_music-master\\light-webplayer\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue_cloud_music-master\\light-webplayer\\src\\components\\lyricsScroll\\LyricsScroll.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue_cloud_music-master\\light-webplayer\\src\\components\\lyricsScroll\\LyricsScroll.vue","mtime":1632135031000},{"path":"D:\\vue_cloud_music-master\\light-webplayer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1636408355875},{"path":"D:\\vue_cloud_music-master\\light-webplayer\\node_modules\\babel-loader\\lib\\index.js","mtime":1636408357214},{"path":"D:\\vue_cloud_music-master\\light-webplayer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1636408355875},{"path":"D:\\vue_cloud_music-master\\light-webplayer\\node_modules\\vue-loader\\lib\\index.js","mtime":1636408357599}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmxldCBwbGFjZWhvbGRlckhlaWdodCA9IDA7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiTHlyaWNzU2Nyb2xsIiwKICBwcm9wczogewogICAgbHlyaWM6IHsKICAgICAgdHlwZTogQXJyYXksCiAgICAgIGRlZmF1bHQ6IFtdLAogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICAvLyDlvZPliY3mrYzor43ntKLlvJUKICAgICAgbHlyaWNzSW5kZXg6IDAsCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgLy8g5a6e546w5q2M6K+N5rua5YqoCiAgICBseXJpY1Njcm9sbChjdXJyZW50THlyaWMpIHsKICAgICAgLy8g6I635Y+W5q2M6K+NaXRlbQogICAgICBsZXQgbHlyaWNzQXJyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmx5cmljc0l0ZW0iKTsKICAgICAgLy8g6I635Y+W5q2M6K+N5qGGCiAgICAgIGxldCBseXJpY3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubHlyaWNzIik7CiAgICAgIC8vIHBsYWNlaG9sZGVy55qE6auY5bqmCiAgICAgIGlmIChwbGFjZWhvbGRlckhlaWdodCA9PSAwKSB7CiAgICAgICAgcGxhY2Vob2xkZXJIZWlnaHQgPSBseXJpY3NBcnJbMF0ub2Zmc2V0VG9wIC0gbHlyaWNzLm9mZnNldFRvcDsKICAgICAgfQogICAgICAvLyAgIOatjOivjWl0ZW3lnKjmrYzor43moYbnmoTpq5jluqYgPSDmrYzor43moYbnmoRvZmZzZXRUb3AgLSDmrYzor41pdGVt55qEb2Zmc2V0VG9wCiAgICAgIC8vICAgY29uc29sZS5sb2coY3VycmVudEx5cmljKTsKICAgICAgaWYgKGx5cmljc0FycltjdXJyZW50THlyaWMgLSAxXSkgewogICAgICAgIGxldCBkaXN0YW5jZSA9IGx5cmljc0FycltjdXJyZW50THlyaWMgLSAxXS5vZmZzZXRUb3AgLSBseXJpY3Mub2Zmc2V0VG9wOwogICAgICAgIC8vICAgbHlyaWNzQXJyW2N1cnJlbnRMeXJpY10uc2Nyb2xsSW50b1ZpZXcoKTsKICAgICAgICBseXJpY3Muc2Nyb2xsVG8oewogICAgICAgICAgYmVoYXZpb3I6ICJzbW9vdGgiLAogICAgICAgICAgdG9wOiBkaXN0YW5jZSAtIHBsYWNlaG9sZGVySGVpZ2h0LAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLy/ojrflj5blvZPliY3mrYzor43ntKLlvJUKICAgIGdldEN1cnJlbnRMeXJpY3NJbmRleChjdXJyZW50VGltZSkgewogICAgICBsZXQgbHlyaWNzSW5kZXggPSAwOwogICAgICB0aGlzLmx5cmljLnNvbWUoKGl0ZW0pID0+IHsKICAgICAgICBpZiAobHlyaWNzSW5kZXggPCB0aGlzLmx5cmljLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIGlmIChjdXJyZW50VGltZSA+IGl0ZW1bMF0pIHsKICAgICAgICAgICAgbHlyaWNzSW5kZXggKz0gMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjdXJyZW50VGltZSA8PSBpdGVtWzBdOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8vIGNvbnNvbGUubG9nKGx5cmljc0luZGV4KTsKICAgICAgdGhpcy5seXJpY3NJbmRleCA9IGx5cmljc0luZGV4OwogICAgfSwKICB9LAogIHdhdGNoOiB7CiAgICAvLyDnm5HlkKzlvZPliY3mkq3mlL7ml7bpl7QKICAgICIkc3RvcmUuc3RhdGUuY3VycmVudFRpbWUiKGN1cnJlbnRUaW1lLCBsYXN0VGltZSkgewogICAgICAvLyDlpoLmnpzkuKTkuKrml7bpl7Tpl7TpmpTmnIkx56eSLOWImeWPr+W+l+efpei/m+W6puadoeiiq+aLluWKqCDpnIDopoHph43mlrDmoKHlh4bmrYzor41pbmRleAogICAgICAvLyDlvZPmrYzor43mlbDph4/lpKfkuo4x5bm25LiU57Si5byV5Li66Zu25pe2LOWPr+iDveatjOivjeS9jee9ruW3rui3nei+g+WkpyzotbDov5nkuKppZui/m+ihjOW/q+mAn+i3s+i9rAogICAgICBpZiAoCiAgICAgICAgKGxhc3RUaW1lICYmIE1hdGguYWJzKGN1cnJlbnRUaW1lIC0gbGFzdFRpbWUpID49IDEpIHx8CiAgICAgICAgKHRoaXMubHlyaWNzSW5kZXggPT0gMCAmJiB0aGlzLmx5cmljLmxlbmd0aCA+IDEpCiAgICAgICkgewogICAgICAgIC8vIOWkhOeQhuaSreaUvuaXtumXtOi3s+i9rOaXtuatjOivjeS9jee9rueahOagoeWHhgogICAgICAgIGlmICh0aGlzLmx5cmljLmxlbmd0aCA+IDEpIHsKICAgICAgICAgIHRoaXMuZ2V0Q3VycmVudEx5cmljc0luZGV4KGN1cnJlbnRUaW1lKTsKICAgICAgICAgIC8vIOa7keWKqOWIsOW9k+WJjeatjOivjQogICAgICAgICAgdGhpcy5seXJpY1Njcm9sbCh0aGlzLmx5cmljc0luZGV4KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8g5qC55o2u5a6e5pe25pKt5pS+5pe26Ze05a6e546w5q2M6K+N5rua5YqoCiAgICAgIGlmICh0aGlzLmx5cmljc0luZGV4IDwgdGhpcy5seXJpYy5sZW5ndGgpIHsKICAgICAgICBpZiAoY3VycmVudFRpbWUgPj0gdGhpcy5seXJpY1t0aGlzLmx5cmljc0luZGV4XVswXSkgewogICAgICAgICAgdGhpcy5seXJpY3NJbmRleCArPSAxOwogICAgICAgICAgdGhpcy5seXJpY1Njcm9sbCh0aGlzLmx5cmljc0luZGV4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDnm5HlkKx2dWV45Lit55qEbXVzaWNJZCDph43nva7mrYzor43ntKLlvJUKICAgICIkc3RvcmUuc3RhdGUubXVzaWNJZCIobXVzaWNJZCkgewogICAgICB0aGlzLmx5cmljc0luZGV4ID0gMDsKICAgIH0sCiAgICBseXJpYyhjdXJyZW50KSB7CiAgICAgIGNvbnNvbGUubG9nKCLojrflj5bkuobmrYzor40iKTsKICAgICAgLy8g5aSn5LqO5LiA56eS77yM6K+05piO5q2M6K+N5ZyoMeenkuWQjuaJjeivt+axguaIkOWKnyDmrYzor43lj6/og73kuI3og73pqazkuIrot7PovazliLDlvZPliY3ml7bpl7Qg6L+Z6YeM6L+b6KGM5qCh5YeGCiAgICAgIGlmICh0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50VGltZSA+IDEpIHsKICAgICAgICAvLyDlpITnkIbmkq3mlL7ml7bpl7Tot7Povazml7bmrYzor43kvY3nva7nmoTmoKHlh4YKICAgICAgICBpZiAodGhpcy5seXJpYy5sZW5ndGggPiAxKSB7CiAgICAgICAgICB0aGlzLmdldEN1cnJlbnRMeXJpY3NJbmRleCh0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50VGltZSk7CiAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgIC8vIOa7keWKqOWIsOW9k+WJjeatjOivjQogICAgICAgICAgICB0aGlzLmx5cmljU2Nyb2xsKHRoaXMubHlyaWNzSW5kZXgpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogIH0sCiAgY3JlYXRlZCgpIHt9LAogIG1vdW50ZWQoKSB7fSwKfTsK"},{"version":3,"sources":["LyricsScroll.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LyricsScroll.vue","sourceRoot":"src/components/lyricsScroll","sourcesContent":["<template>\n  <div class=\"lyrics\">\n    <!-- 占位 -->\n    <div class=\"placeholder\"></div>\n    <!-- 因为歌词快了一句,所以减1 -->\n    <!-- 歌词item -->\n    <div\n      class=\"lyricsItem\"\n      :class=\"lyricsIndex - 1 == index ? 'currentLyric' : ''\"\n      v-for=\"(item, index) in lyric\"\n      :key=\"index\"\n    >\n      {{ item[1] }}\n    </div>\n    <!-- 占位 -->\n    <div class=\"placeholder\"></div>\n  </div>\n</template>\n\n<script>\nlet placeholderHeight = 0;\nexport default {\n  name: \"LyricsScroll\",\n  props: {\n    lyric: {\n      type: Array,\n      default: [],\n    },\n  },\n  data() {\n    return {\n      // 当前歌词索引\n      lyricsIndex: 0,\n    };\n  },\n  methods: {\n    // 实现歌词滚动\n    lyricScroll(currentLyric) {\n      // 获取歌词item\n      let lyricsArr = document.querySelectorAll(\".lyricsItem\");\n      // 获取歌词框\n      let lyrics = document.querySelector(\".lyrics\");\n      // placeholder的高度\n      if (placeholderHeight == 0) {\n        placeholderHeight = lyricsArr[0].offsetTop - lyrics.offsetTop;\n      }\n      //   歌词item在歌词框的高度 = 歌词框的offsetTop - 歌词item的offsetTop\n      //   console.log(currentLyric);\n      if (lyricsArr[currentLyric - 1]) {\n        let distance = lyricsArr[currentLyric - 1].offsetTop - lyrics.offsetTop;\n        //   lyricsArr[currentLyric].scrollIntoView();\n        lyrics.scrollTo({\n          behavior: \"smooth\",\n          top: distance - placeholderHeight,\n        });\n      }\n    },\n    //获取当前歌词索引\n    getCurrentLyricsIndex(currentTime) {\n      let lyricsIndex = 0;\n      this.lyric.some((item) => {\n        if (lyricsIndex < this.lyric.length - 1) {\n          if (currentTime > item[0]) {\n            lyricsIndex += 1;\n          }\n          return currentTime <= item[0];\n        }\n      });\n      // console.log(lyricsIndex);\n      this.lyricsIndex = lyricsIndex;\n    },\n  },\n  watch: {\n    // 监听当前播放时间\n    \"$store.state.currentTime\"(currentTime, lastTime) {\n      // 如果两个时间间隔有1秒,则可得知进度条被拖动 需要重新校准歌词index\n      // 当歌词数量大于1并且索引为零时,可能歌词位置差距较大,走这个if进行快速跳转\n      if (\n        (lastTime && Math.abs(currentTime - lastTime) >= 1) ||\n        (this.lyricsIndex == 0 && this.lyric.length > 1)\n      ) {\n        // 处理播放时间跳转时歌词位置的校准\n        if (this.lyric.length > 1) {\n          this.getCurrentLyricsIndex(currentTime);\n          // 滑动到当前歌词\n          this.lyricScroll(this.lyricsIndex);\n        }\n      }\n      // 根据实时播放时间实现歌词滚动\n      if (this.lyricsIndex < this.lyric.length) {\n        if (currentTime >= this.lyric[this.lyricsIndex][0]) {\n          this.lyricsIndex += 1;\n          this.lyricScroll(this.lyricsIndex);\n        }\n      }\n    },\n    // 监听vuex中的musicId 重置歌词索引\n    \"$store.state.musicId\"(musicId) {\n      this.lyricsIndex = 0;\n    },\n    lyric(current) {\n      console.log(\"获取了歌词\");\n      // 大于一秒，说明歌词在1秒后才请求成功 歌词可能不能马上跳转到当前时间 这里进行校准\n      if (this.$store.state.currentTime > 1) {\n        // 处理播放时间跳转时歌词位置的校准\n        if (this.lyric.length > 1) {\n          this.getCurrentLyricsIndex(this.$store.state.currentTime);\n          this.$nextTick(() => {\n            // 滑动到当前歌词\n            this.lyricScroll(this.lyricsIndex);\n          });\n        }\n      }\n    },\n  },\n  created() {},\n  mounted() {},\n};\n</script>\n\n<style scoped>\n.lyrics {\n  width: 100%;\n  height: 275px;\n  font-size: 12px;\n  text-align: center;\n  overflow-y: scroll;\n  /* overflow: scroll; */\n}\n\n.lyrics::-webkit-scrollbar {\n  display: none;\n}\n\n.lyricsItem {\n  font-size: 12px;\n  /* height: 20px; */\n  margin: 25px 20px;\n  transition: all 0.5s;\n  line-height: 20px;\n}\n\n.currentLyric {\n  font-weight: 600;\n  font-size: 14px;\n  color: black;\n}\n\n.placeholder {\n  width: 100%;\n  height: 40%;\n}\n</style>"]}]}